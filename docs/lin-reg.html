<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>9 Linear regression | Environmental Statistics</title>
<meta name="author" content="Christina Bogner, Marijn van der Meij">
<meta name="description" content="Explain the general structure of a linear model.  Name the assumption of a linear model.  Calculate a simple linear regression in R.  With this chapter, we start our journey to statistical...">
<meta name="generator" content="bookdown 0.42 with bs4_book()">
<meta property="og:title" content="9 Linear regression | Environmental Statistics">
<meta property="og:type" content="book">
<meta property="og:description" content="Explain the general structure of a linear model.  Name the assumption of a linear model.  Calculate a simple linear regression in R.  With this chapter, we start our journey to statistical...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="9 Linear regression | Environmental Statistics">
<meta name="twitter:description" content="Explain the general structure of a linear model.  Name the assumption of a linear model.  Calculate a simple linear regression in R.  With this chapter, we start our journey to statistical...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="font-awesome.min.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Summer term 2025">Environmental Statistics</a>:
        <small class="text-muted">Summer term 2025</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">Part I: Explore data</li>
<li><a class="" href="introduction-to-r-and-rstudio.html"><span class="header-section-number">1</span> Introduction to R and RStudio</a></li>
<li><a class="" href="using-r-markdown-for-reproducible-research.html"><span class="header-section-number">2</span> Using R Markdown for reproducible research</a></li>
<li><a class="" href="what-is-data.html"><span class="header-section-number">3</span> What is data?</a></li>
<li><a class="" href="import-visualize-and-explore-data.html"><span class="header-section-number">4</span> Import, visualize and explore data</a></li>
<li><a class="" href="tidyverse.html"><span class="header-section-number">5</span> Explorative workflow with tidyverse</a></li>
<li class="book-part">Part II: Statistical inference</li>
<li><a class="" href="sampling.html"><span class="header-section-number">6</span> Sampling and variability</a></li>
<li><a class="" href="bootstrap.html"><span class="header-section-number">7</span> Bootstrap and confidence intervals</a></li>
<li><a class="" href="hypothesis.html"><span class="header-section-number">8</span> Hypothesis tests versus effect size estimation</a></li>
<li class="book-part">Part III: Statistical modelling</li>
<li><a class="active" href="lin-reg.html"><span class="header-section-number">9</span> Linear regression</a></li>
<li><a class="" href="lin-reg-inference.html"><span class="header-section-number">10</span> Inference in linear regression</a></li>
<li class="book-part">Part IV: Additional topics</li>
<li><a class="" href="tsa.html"><span class="header-section-number">11</span> Introduction to time series analysis</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="stat-background.html"><span class="header-section-number">A</span> Statistics refresher</a></li>
<li><a class="" href="daten-und-bericht.html"><span class="header-section-number">B</span> Data sources and final report</a></li>
<li><a class="" href="additional-exercises.html"><span class="header-section-number">C</span> Additional exercises</a></li>
<li><a class="" href="faq.html"><span class="header-section-number">D</span> Frequently and not-so-frequently asked questions</a></li>
<li><a class="" href="literature-1.html">Literature</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ChrisBogner/environmental_stat">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="lin-reg" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Linear regression<a class="anchor" aria-label="anchor" href="#lin-reg"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdoutcomes">
<ul>
<li>
Explain the general structure of a linear model.
</li>
<li>
Name the assumption of a linear model.
</li>
<li>
Calculate a simple linear regression in R.
</li>
</ul>
</div>
<p>With this chapter, we start our journey to statistical modelling. Basically, there are two main reasons why one would like to build a statistical model.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Explicative modelling</strong>: We suppose that there is a relationship between variables and would like to quantify it.</li>
<li>
<strong>Predictive modelling</strong>: We want to build a model that can (as accurately as possible) predict future values.</li>
</ol>
<p>In this course, we will focus on explicative modelling and work with linear regression models.</p>
<div id="what-is-a-linear-regression-model" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> What is a linear regression model?<a class="anchor" aria-label="anchor" href="#what-is-a-linear-regression-model"><i class="fas fa-link"></i></a>
</h2>
<p>The term <strong>regression</strong> was coined by Francis Galton (1822-1911) who studied the relationship between the height of parents and their children <span class="citation">(<a href="literature-1.html#ref-Fahrmeir2009">Fahrmeir, Kneib, and Lang 2009</a>)</span>. He showed that taller-than-average parents tended to have children who were smaller than their parents (more towards the average) and smaller-than-average parents tended to have taller children. He called this phenomenon <strong>regression towards the mean</strong>.</p>
<p>A regression model estimates the relationship between a dependent variable, often called <span class="math inline">\(y\)</span> and independent variables (or predictors) often termed <span class="math inline">\(X\)</span>. Note the capital letter <span class="math inline">\(X\)</span> to indicate that it can be a collection of independent variables (a matrix). We try a definition:</p>
<div class="rmddef">
<p>
A <strong>regression model</strong> has the form:
</p>
<p>
<span class="math display"><span class="math display">\[y = f(X) + \varepsilon\]</span></span>
</p>
<ul>
<li>
<span class="math inline"><span class="math inline">\(y\)</span></span>: dependent variable
</li>
<li>
<span class="math inline"><span class="math inline">\(f\)</span></span>: type of relationship
(function)
</li>
<li>
<span class="math inline"><span class="math inline">\(X\)</span></span>: independent variables
(predictors, explanatory variables)
</li>
<li>
<span class="math inline"><span class="math inline">\(\varepsilon\)</span></span>: error term
</li>
</ul>
<p>
If:
</p>
<ul>
<li>
<span class="math inline"><span class="math inline">\(f\)</span></span> linear (effect of predictors
is additive), the model is called <strong>linear regression
model</strong>
</li>
<li>
<span class="math inline"><span class="math inline">\(X\)</span></span> is a single predictor, the
model is called <strong>simple linear regression model</strong>,
otherwise <strong>multiple linear regression model</strong>
</li>
</ul>
<p>
Components of the model:
</p>
<ul>
<li>
<span class="math inline"><span class="math inline">\(f(X)\)</span></span>: systematic or
deterministic component
</li>
<li>
<span class="math inline"><span class="math inline">\(\varepsilon\)</span></span>: stochastic
component (error term, residuals)
</li>
</ul>
</div>
<p>In a regression model, we are not after the exact values of the dependent variable, but after the systematic influence of predictors on the mean value of the dependent variable. Because of the error term (which can contain random fluctuations, measurement errors etc.), the dependent variable <span class="math inline">\(y\)</span> is a <strong>random variable</strong>.</p>
</div>
<div id="simple-linear-regression" class="section level2" number="9.2">
<h2>
<span class="header-section-number">9.2</span> Simple linear regression<a class="anchor" aria-label="anchor" href="#simple-linear-regression"><i class="fas fa-link"></i></a>
</h2>
<p>In case we have one predictor only, the model is a simple linear regression model and its geometric form is a line. A line is defined by its intercept (the point where it cuts the <span class="math inline">\(y\)</span> axis) and its slope. This is precisely the form of a simple linear regression model:</p>
<div class="rmddef">
<p>
Given <strong>data</strong> pairs: <span class="math inline"><span class="math inline">\((y_i,x_i), \quad i=1,\dots,n\)</span></span>
</p>
<p>
<span class="math inline"><span class="math inline">\(y\)</span></span> and <span class="math inline"><span class="math inline">\(x\)</span></span> are numeric variables.
</p>
<p>
We call the model <span class="math display"><span class="math display">\[y_i=\beta_0 +
\beta_1x_i + \varepsilon_i, \qquad i=1,\dots,n.\]</span></span>
</p>
<p>
a <strong>simple linear regression model</strong>, if the errors
<span class="math inline"><span class="math inline">\(\varepsilon_1,\dots, \varepsilon_n\)</span></span>
are independent and identically distributed (iid) and
</p>
<p>
<span class="math display"><span class="math display">\[\mathrm{E}(\varepsilon_i) = 0, \qquad
\mathrm{Var}(\varepsilon_i)=\sigma^2.\]</span></span>
</p>
<p>
If additionally <span class="math display"><span class="math display">\[\varepsilon_i \sim
N(0,\sigma^2)\]</span></span>
</p>
<p>
i.e.¬†the residuals are normally distributed, we call the model a
<strong>normal linear regression model</strong>.
</p>
<p>
<span class="math inline"><span class="math inline">\(\beta_0\)</span></span> is the intercept and
<span class="math inline"><span class="math inline">\(\beta_1\)</span></span> the slope of the model.
</p>
</div>
<p>The assumptions of the normal linear regression model can be summarized as LINE:</p>
<ol style="list-style-type: decimal">
<li>
<strong>L</strong>inear relationship between variables</li>
<li>
<strong>I</strong>ndependence of residuals</li>
<li>
<strong>N</strong>ormal residuals</li>
<li>
<strong>E</strong>quality of variance (called homoscedasticity) and a mean of zero in residuals</li>
</ol>
<p>Before you look at the model results, the confidence intervals of the slope or the intercept, you have to ensure that those assumptions are met!</p>
</div>
<div id="example-relationship-between-the-time-in-the-library-and-the-travel-time" class="section level2" number="9.3">
<h2>
<span class="header-section-number">9.3</span> Example: Relationship between the time in the library and the travel time<a class="anchor" aria-label="anchor" href="#example-relationship-between-the-time-in-the-library-and-the-travel-time"><i class="fas fa-link"></i></a>
</h2>
<p>We come back to our lovely getsmarter university and want to study the relationship between the time a student needs to come to the university and the time she spends in the library.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/infer">infer</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://moderndive.github.io/moderndive/">moderndive</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span></code></pre></div>
<p>Let‚Äôs generate the population.</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">student_id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12000</span></span>
<span>  </span>
<span><span class="va">travel_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12000</span> <span class="op">*</span> <span class="fl">0.8</span>, min <span class="op">=</span> <span class="fl">5</span>, max <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">12000</span> <span class="op">*</span> <span class="fl">0.2</span>, min <span class="op">=</span> <span class="fl">60</span>, max <span class="op">=</span> <span class="fl">120</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'m'</span>, <span class="st">'f'</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">12000</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">residence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">travel_time</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">30</span><span class="op">)</span> <span class="st">'urban'</span></span>
<span>  <span class="kw">else</span> <span class="st">'rural'</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transport</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">travel_time</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> <span class="st">'foot'</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">15</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'foot'</span>, <span class="st">'bike'</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">15</span> <span class="op">&amp;</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">45</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'bus'</span>, <span class="st">'bike'</span>, <span class="st">'car'</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'bus'</span>, <span class="st">'car'</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_lib</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="op">*</span> <span class="fl">60</span> <span class="op">-</span> <span class="fl">0.7</span> <span class="op">*</span> <span class="va">travel_time</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">travel_time</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">getsmarter_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">student_id</span>, <span class="va">gender</span>, <span class="va">residence</span>, <span class="va">transport</span>, <span class="va">travel_time</span>, <span class="va">time_lib</span><span class="op">)</span></span>
<span></span>
<span><span class="va">getsmarter_pop</span></span></code></pre></div>
<pre><code>## # A tibble: 12,000 √ó 6
##    student_id gender residence transport travel_time time_lib
##         &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;
##  1          1 f      urban     bus             15.1      294.
##  2          2 f      rural     bike            32.6      254.
##  3          3 f      urban     bike            19.3      231.
##  4          4 m      rural     car             35.9      245.
##  5          5 m      rural     bus             37.9      234.
##  6          6 f      urban     foot             6.59     303.
##  7          7 f      urban     bus             23.5      284.
##  8          8 m      rural     car             36.2      274.
##  9          9 m      urban     bike            24.3      299.
## 10         10 f      urban     bus             21.0      282.
## # ‚Ñπ 11,990 more rows</code></pre>
<p>We survey 200 students.</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">345</span><span class="op">)</span></span>
<span></span>
<span><span class="va">survey_size</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="va">survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://infer.tidymodels.org/reference/rep_sample_n.html">rep_sample_n</a></span><span class="op">(</span><span class="va">getsmarter_pop</span>, size <span class="op">=</span> <span class="va">survey_size</span>, replace <span class="op">=</span> <span class="cn">FALSE</span>, reps <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div id="fit-a-simple-normal-regression-model" class="section level3" number="9.3.1">
<h3>
<span class="header-section-number">9.3.1</span> Fit a simple normal regression model<a class="anchor" aria-label="anchor" href="#fit-a-simple-normal-regression-model"><i class="fas fa-link"></i></a>
</h3>
<p>We first check that the linear model makes sense and the relationship between the two variables is (approximately) linear.</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">survey</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">travel_time</span>, y <span class="op">=</span> <span class="va">time_lib</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Travel time (min)'</span>, y <span class="op">=</span> <span class="st">'Time in the library (min)'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-128-1.png" width="90%"></div>
<p>This looks reasonably linear, and we can proceed with the modelling.</p>
<p>To fit a linear model in R, we use the function <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. The dependent and the independent variables are joined in a <code>formula</code> by a tilde sign <code>~</code>. You can also omit the word formula and just type <code>time_lib ~ travel_time</code>.</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lin_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">time_lib</span> <span class="op">~</span> <span class="va">travel_time</span>, data <span class="op">=</span> <span class="va">survey</span><span class="op">)</span></span></code></pre></div>
<p>That‚Äôs it üòÑ.</p>
<p>Let‚Äôs have a look at the estimated intercept and the slope. The function <code>get_regression_table</code> provides a tidy form of the model results, and the function <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable()</a></code> layouts them nicely.</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="moderndive.github.io/moderndive/reference/get_regression_table.html">get_regression_table</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="17%">
<col width="13%">
<col width="14%">
<col width="14%">
<col width="11%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std_error</th>
<th align="right">statistic</th>
<th align="right">p_value</th>
<th align="right">lower_ci</th>
<th align="right">upper_ci</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">intercept</td>
<td align="right">302.094</td>
<td align="right">2.282</td>
<td align="right">132.387</td>
<td align="right">0</td>
<td align="right">297.594</td>
<td align="right">306.594</td>
</tr>
<tr class="even">
<td align="left">travel_time</td>
<td align="right">-0.766</td>
<td align="right">0.051</td>
<td align="right">-14.990</td>
<td align="right">0</td>
<td align="right">-0.867</td>
<td align="right">-0.665</td>
</tr>
</tbody>
</table></div>
<p>The estimated intercept equals 302.094 minutes and the slope -0.766 minutes, respectively. We can write our model as:</p>
<p><span class="math display">\[\widehat{\text{time_lib}_i} = 302.094 - 0.766 \cdot \text{travel_time}_i + \varepsilon_i\]</span>
The model estimates a <code>time_lib</code> value for every student <span class="math inline">\(i\)</span>, with <span class="math inline">\(i\)</span> being an arbitrary student index running from 1 to 200 because we have surveyed 200 students. The ‚Äúhat‚Äù above <span class="math inline">\(\text{time_lib}_i\)</span> indicates that this is an estimate. The estimated time in the library is the systematic component of the model, namely <span class="math inline">\(302.094 - 0.766 \cdot \text{travel_time}_i\)</span>. The difference of the actual time in the library and this estimated value is the error term or the residuum <span class="math inline">\(\varepsilon_i\)</span>.</p>
<p>To simplify our analysis, we put the original data, estimated values (also called fitted values) and the residuals in one tibble. The respective values can be extracted from the model object <code>lin_mod</code> with the functions <code><a href="https://rdrr.io/r/stats/fitted.values.html">fitted()</a></code> and <code><a href="https://rdrr.io/r/stats/residuals.html">residuals()</a></code>.</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_res</span> <span class="op">&lt;-</span> <span class="va">survey</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>fitted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span>, residuals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_res</span></span></code></pre></div>
<pre><code>## # A tibble: 200 √ó 9
## # Groups:   replicate [1]
##    replicate student_id gender residence transport travel_time time_lib fitted
##        &lt;int&gt;      &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1         1       1623 m      urban     foot             7.06     299.   297.
##  2         1       9171 m      urban     bike            11.3      278.   293.
##  3         1      10207 f      rural     bus            107.       199.   220.
##  4         1       3506 f      urban     bus             25.0      326.   283.
##  5         1       8892 f      urban     bus             28.1      259.   281.
##  6         1       5460 m      urban     bus             23.6      299.   284.
##  7         1       6120 f      urban     bus             20.0      268.   287.
##  8         1        865 f      urban     bike            26.6      290.   282.
##  9         1      11586 m      rural     bus            114.       207.   215.
## 10         1       8153 f      urban     foot             8.06     297.   296.
## # ‚Ñπ 190 more rows
## # ‚Ñπ 1 more variable: residuals &lt;dbl&gt;</code></pre>
<p>Let‚Äôs have a look at the residuals and the fitted values.</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">model_res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">travel_time</span>, y <span class="op">=</span> <span class="va">time_lib</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">travel_time</span>, yend <span class="op">=</span> <span class="va">fitted</span>, lty <span class="op">=</span> <span class="st">'Residuals'</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">'observed'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">fitted</span>, col <span class="op">=</span> <span class="st">'fitted'</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Travel time (min)'</span>, y <span class="op">=</span> <span class="st">'Time in the library (min)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">''</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>observed <span class="op">=</span> <span class="st">'black'</span>, fitted <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'observed'</span>, <span class="st">'fitted'</span><span class="op">)</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Observed values'</span>, <span class="st">'Fitted values'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_linetype_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">''</span>, values <span class="op">=</span> <span class="op">(</span><span class="st">'Residuals'</span> <span class="op">=</span> <span class="st">'solid'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-132-1.png" width="90%"></div>
</div>
<div id="model-assumptions" class="section level3" number="9.3.2">
<h3>
<span class="header-section-number">9.3.2</span> Model assumptions<a class="anchor" aria-label="anchor" href="#model-assumptions"><i class="fas fa-link"></i></a>
</h3>
<p>Before we interpret the meaning of the model parameters <em>intercept</em> and <em>slope</em>, we have to check the model assumptions. We already saw that the relationship is reasonably linear. Let‚Äôs look at the rest of the assumptions.</p>
<p><strong>Independent residuals</strong>. This is difficult to check and should come with the study design. If you have, like in our example, independently surveyed students, you can reasonably assume that both, the data and the residuals are independent. Conversely, it means that you cannot use a normal linear regression model for time -dependent data (time series) or spatially dependent data. The line you fit will still be correct, but the confidence intervals won‚Äôt.</p>
<p><strong>Normal residuals.</strong> To check for normality of residuals, we use a graphical tool, namely the so-called qq-plot. It compares random data from a normal distribution with our residuals. If the data fall on strait line (at least approximately) then we can conclude that our residuals are normally distributed.</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">model_res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Quantiles of the normal distribution'</span>,</span>
<span>       y <span class="op">=</span> <span class="st">'Qauntiles of the residuals'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-133-1.png" width="90%"></div>
<p>This looks good üòÑ. You will need some practice to judge the qq-plots. You need to worry if you see large deviations from the line for small and large values.</p>
<p><strong>Equal variance and zero mean.</strong> For the last assumption, we plot the residuals versus fitted values. It is important that the residuals remain (approximately) equally large for small and large fitted values and fluctuate around zero.</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">model_res</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fitted</span>, y <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">0</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Fitted values'</span>, y <span class="op">=</span> <span class="st">'Residuals'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-134-1.png" width="90%"></div>
<p>We have slightly larger residuals for larger fitted values. However, we also have more large than small fitted values (i.e., travel times). This distorts the picture a bit. Overall, there is no serious problem there.</p>
</div>
<div id="interprete-your-model" class="section level3" number="9.3.3">
<h3>
<span class="header-section-number">9.3.3</span> Interprete your model<a class="anchor" aria-label="anchor" href="#interprete-your-model"><i class="fas fa-link"></i></a>
</h3>
<p>We can conclude that our model meets all the assumptions. Therefore, we can interpret the estimated parameters and their confidence intervals now.</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="moderndive.github.io/moderndive/reference/get_regression_table.html">get_regression_table</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="17%">
<col width="13%">
<col width="14%">
<col width="14%">
<col width="11%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std_error</th>
<th align="right">statistic</th>
<th align="right">p_value</th>
<th align="right">lower_ci</th>
<th align="right">upper_ci</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">intercept</td>
<td align="right">302.094</td>
<td align="right">2.282</td>
<td align="right">132.387</td>
<td align="right">0</td>
<td align="right">297.594</td>
<td align="right">306.594</td>
</tr>
<tr class="even">
<td align="left">travel_time</td>
<td align="right">-0.766</td>
<td align="right">0.051</td>
<td align="right">-14.990</td>
<td align="right">0</td>
<td align="right">-0.867</td>
<td align="right">-0.665</td>
</tr>
</tbody>
</table></div>
<p>We see that the time a student spend in the library decreases with increasing travel time. More precisely, if the travel time increases by one minute, the time spent in the library changes by -0.8 [-0.9, -0.7]. The confidence interval is narrow. This means that the estimation is precise.</p>
<p>Now, we need to frame our result. A decrease by less than a minute per minute travel time sounds rather small. However, if a student needs one hour more to come to the university, she spends roughly 45 minutes less in the library. Basically, the time spent for travelling cannot be spent working in the library. Stated like this, the result is important for students‚Äô time management.</p>
</div>
</div>
<div id="practice-on-your-own-8" class="section level2" number="9.4">
<h2>
<span class="header-section-number">9.4</span> Practice on your own!<a class="anchor" aria-label="anchor" href="#practice-on-your-own-8"><i class="fas fa-link"></i></a>
</h2>
<ol class="exercises"><ol style="list-style-type: decimal">
<li>Predictors do not need to be numeric. Work through Chapter 5.2 in <span class="citation">Ismay and Kim (<a href="literature-1.html#ref-ModernDive">2021</a>)</span> to see an example of a categorical predictor.</li>
</ol></ol>
</div>
<div id="reading-assignment-7" class="section level2" number="9.5">
<h2>
<span class="header-section-number">9.5</span> Reading assignment<a class="anchor" aria-label="anchor" href="#reading-assignment-7"><i class="fas fa-link"></i></a>
</h2>
<p>Chapter 5 in <span class="citation">Ismay and Kim (<a href="literature-1.html#ref-ModernDive">2021</a>)</span></p>
<!-- ## Turning in your work -->
<!-- - Save your R Notebook as an *.Rmd file.  -->
<!-- - Upload your R Notebook to ILIAS. You don't need to upload the .nb.html file. You will find an upload option in today's session. -->
<!-- - You should receive a solution file after your upload. **Be sure to upload before the deadline!** -->

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="hypothesis.html"><span class="header-section-number">8</span> Hypothesis tests versus effect size estimation</a></div>
<div class="next"><a href="lin-reg-inference.html"><span class="header-section-number">10</span> Inference in linear regression</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#lin-reg"><span class="header-section-number">9</span> Linear regression</a></li>
<li><a class="nav-link" href="#what-is-a-linear-regression-model"><span class="header-section-number">9.1</span> What is a linear regression model?</a></li>
<li><a class="nav-link" href="#simple-linear-regression"><span class="header-section-number">9.2</span> Simple linear regression</a></li>
<li>
<a class="nav-link" href="#example-relationship-between-the-time-in-the-library-and-the-travel-time"><span class="header-section-number">9.3</span> Example: Relationship between the time in the library and the travel time</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#fit-a-simple-normal-regression-model"><span class="header-section-number">9.3.1</span> Fit a simple normal regression model</a></li>
<li><a class="nav-link" href="#model-assumptions"><span class="header-section-number">9.3.2</span> Model assumptions</a></li>
<li><a class="nav-link" href="#interprete-your-model"><span class="header-section-number">9.3.3</span> Interprete your model</a></li>
</ul>
</li>
<li><a class="nav-link" href="#practice-on-your-own-8"><span class="header-section-number">9.4</span> Practice on your own!</a></li>
<li><a class="nav-link" href="#reading-assignment-7"><span class="header-section-number">9.5</span> Reading assignment</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ChrisBogner/environmental_stat/blob/master/docs/09-linear-regression.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ChrisBogner/environmental_stat/edit/master/docs/09-linear-regression.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Environmental Statistics</strong>: Summer term 2025" was written by Christina Bogner, Marijn van der Meij. It was last built on 2025-06-23.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
