<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Explorative workflow with tidyverse | Environmental Statistics</title>
<meta name="author" content="Christina Bogner">
<meta name="description" content="Name core packages in tidyverse  Apply a simple explorative workflow (read, summarize, plot) with tidyverse  Use functions from dplyr for data wrangling  tidyverse is a collection of R packages...">
<meta name="generator" content="bookdown 0.24.3 with bs4_book()">
<meta property="og:title" content="5 Explorative workflow with tidyverse | Environmental Statistics">
<meta property="og:type" content="book">
<meta property="og:description" content="Name core packages in tidyverse  Apply a simple explorative workflow (read, summarize, plot) with tidyverse  Use functions from dplyr for data wrangling  tidyverse is a collection of R packages...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 Explorative workflow with tidyverse | Environmental Statistics">
<meta name="twitter:description" content="Name core packages in tidyverse  Apply a simple explorative workflow (read, summarize, plot) with tidyverse  Use functions from dplyr for data wrangling  tidyverse is a collection of R packages...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="font-awesome.min.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Summer term 2021">Environmental Statistics</a>:
        <small class="text-muted">Summer term 2021</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">Part I: Explore data</li>
<li><a class="" href="introduction-to-r-and-rstudio-server.html"><span class="header-section-number">1</span> Introduction to R and RStudio Server</a></li>
<li><a class="" href="using-r-markdown.html"><span class="header-section-number">2</span> Using R Markdown</a></li>
<li><a class="" href="what-is-data.html"><span class="header-section-number">3</span> What is data?</a></li>
<li><a class="" href="import-visualize-and-explore-data.html"><span class="header-section-number">4</span> Import, visualize and explore data</a></li>
<li><a class="active" href="tidyverse.html"><span class="header-section-number">5</span> Explorative workflow with tidyverse</a></li>
<li class="book-part">Part II: Statistical inference</li>
<li><a class="" href="sampling.html"><span class="header-section-number">6</span> Sampling and variability</a></li>
<li><a class="" href="bootstrap.html"><span class="header-section-number">7</span> Bootstrap and confidence intervals</a></li>
<li><a class="" href="hypothesis.html"><span class="header-section-number">8</span> Hypothesis tests versus effect size estimation</a></li>
<li class="book-part">Part III: Statistical modelling</li>
<li><a class="" href="lin-reg.html"><span class="header-section-number">9</span> Linear regression</a></li>
<li><a class="" href="lin-reg-inference.html"><span class="header-section-number">10</span> Inference in linear regression</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="stat-background.html"><span class="header-section-number">A</span> Statistics refresher</a></li>
<li><a class="" href="daten-und-bericht.html"><span class="header-section-number">B</span> Data sources and final report</a></li>
<li><a class="" href="additional-exercises.html"><span class="header-section-number">C</span> Additional exercises</a></li>
<li><a class="" href="faq.html"><span class="header-section-number">D</span> Frequently and not-so-frequently asked questions</a></li>
<li><a class="" href="literature-1.html">Literature</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ChrisBogner/environmental_stat">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidyverse" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Explorative workflow with <code>tidyverse</code><a class="anchor" aria-label="anchor" href="#tidyverse"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdoutcomes">
<ul>
<li>
Name core packages in <code>tidyverse</code>
</li>
<li>
Apply a simple explorative workflow (read, summarize, plot) with <code>tidyverse</code>
</li>
<li>
Use functions from <code>dplyr</code> for data wrangling
</li>
</ul>
</div>
<p><code>tidyverse</code> is a collection of R packages for data analysis (<a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a>). It shares a common philosophy about how data should be structure and grammar of data manipulation and visualisation. Although it might sound like something alien, <code>tidyverse</code> is a regular part of R and its functions can be mixed with base R functions.</p>
<p>The best introduction to <code>tidyverse</code> is <strong>r4ds</strong>: “R for Data Science” <span class="citation">(<a href="literature-1.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2021</a>)</span>. You can read it for free here (<a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a>).</p>
<div id="core-packages" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Core packages<a class="anchor" aria-label="anchor" href="#core-packages"><i class="fas fa-link"></i></a>
</h2>
<p><code>tidyverse</code> comprises 8 core packages that are installed when you call <code>install.packages('tidyverse')</code>:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Packages</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>ggplot2</code></td>
<td align="left">data visualization</td>
</tr>
<tr class="even">
<td align="left"><code>dplyr</code></td>
<td align="left">data transformation</td>
</tr>
<tr class="odd">
<td align="left"><code>tidyr</code></td>
<td align="left">data cleaning</td>
</tr>
<tr class="even">
<td align="left"><code>readr</code></td>
<td align="left">importing data</td>
</tr>
<tr class="odd">
<td align="left"><code>purrr</code></td>
<td align="left">functional programming</td>
</tr>
<tr class="even">
<td align="left"><code>tibble</code></td>
<td align="left">extension of <code>data.frame</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>stringr</code></td>
<td align="left">functions for strings, i.e. text variables</td>
</tr>
<tr class="even">
<td align="left"><code>forcats</code></td>
<td align="left">functions for <code>factor</code>
</td>
</tr>
</tbody>
</table></div>
<p>Every packages has a Cheat Sheet, an overview of its functions. To get a package’s cheat sheet click on its name (<a href="https://www.tidyverse.org/packages/" class="uri">https://www.tidyverse.org/packages/</a>), scroll down to the section Cheatsheet.</p>
<p>Besides its core packages, <code>tidyverse</code> also installes a long list of supplementary packages that you can find here: <a href="https://www.tidyverse.org/packages/" class="uri">https://www.tidyverse.org/packages/</a></p>
</div>
<div id="exploratory-data-analysis" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Exploratory data analysis<a class="anchor" aria-label="anchor" href="#exploratory-data-analysis"><i class="fas fa-link"></i></a>
</h2>
<p>Exploratory data analysis is a very important first step in data analysis. Before using any advanced statistical method, exploratory analysis is a must have. It comprises roughly the following steps:</p>
<ul>
<li>import and inspect data</li>
<li>clean (tidy) data if necessary</li>
<li>summarize it and create new variables if necessary</li>
<li>plot as many different plots as possible to get a good overview about patterns and data distribution</li>
</ul>
<div id="read-data-revisited" class="section level3" number="5.2.1">
<h3>
<span class="header-section-number">5.2.1</span> Read data, revisited<a class="anchor" aria-label="anchor" href="#read-data-revisited"><i class="fas fa-link"></i></a>
</h3>
<p>We load the library <code>tidyverse</code> first.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<p>Last time we used the function <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim()</a></code> to import data into R. This function is the most general from a whole family of functions, all starting with <code>read_*</code>: <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code>, <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2()</a></code> etc. They all have their own parameters that you need to verify on the respective help pages if you want to use them.</p>
<p>For this exploratory data analysis we will use data from the German Meteo Service (Deutscher Wetterdienst) that I downloaded on 2020-05-24 (<a href="https://www.dwd.de/DE/leistungen/klimadatendeutschland/klimadatendeutschland.html" class="uri">https://www.dwd.de/DE/leistungen/klimadatendeutschland/klimadatendeutschland.html</a>). The data set contains hourly measurements of the relative air humidity (%) and air temperature (°C) for three meteo stations, namely Hof, Frankfurt and Köln-Bonn. The data is named <span style="font-family: sans-serif; font-size: 12pt">meteo.csv</span>.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span><span class="op">(</span><span class="st">'data/meteo.csv'</span>, delim <span class="op">=</span> <span class="st">';'</span>,    trim_ws <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 39600 Columns: 6
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ";"
## chr (1): eor
## dbl (5): STATIONS_ID, MESS_DATUM, QN_9, TT_TU, RF_TU
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p><code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim()</a></code> reports on reading the data about the variables it recognizes. This is a good hint to spot for possible problems. Are numerical variables read as <code>&lt;dbl&gt;</code>? Are characters recognized as <code>&lt;char&gt;</code> etc. In the code above, the parameter <code>trim_ws = T</code> removes leading zeroes.</p>
<p>Let’s have a showr glimps of the data.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span></code></pre></div>
<pre><code>## # A tibble: 39,600 × 6
##    STATIONS_ID MESS_DATUM  QN_9 TT_TU RF_TU eor  
##          &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1        2261 2018111900     3  -2.8    99 eor  
##  2        2261 2018111901     3  -2.5   100 eor  
##  3        2261 2018111902     3  -2.3   100 eor  
##  4        2261 2018111903     3  -2     100 eor  
##  5        2261 2018111904     3  -1.9    99 eor  
##  6        2261 2018111905     3  -2.1    99 eor  
##  7        2261 2018111906     3  -1.8    99 eor  
##  8        2261 2018111907     3  -1.5    99 eor  
##  9        2261 2018111908     3  -1.1    99 eor  
## 10        2261 2018111909     3  -0.6    97 eor  
## # … with 39,590 more rows</code></pre>
<p>The data set contains the following variables:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">STATIONS_ID</td>
<td align="left">ID of the meteo station</td>
</tr>
<tr class="even">
<td align="left">MESS_DATUM</td>
<td align="left">date and time of the measurement, formatted as yyyymmddhh</td>
</tr>
<tr class="odd">
<td align="left">QN_9</td>
<td align="left">quality flag</td>
</tr>
<tr class="even">
<td align="left">TT_TU</td>
<td align="left">air temperature in 2 m height in °C</td>
</tr>
<tr class="odd">
<td align="left">RF_TU</td>
<td align="left">relative air humidity in %</td>
</tr>
<tr class="even">
<td align="left">eor</td>
<td align="left">end of record (i.e. end of line)</td>
</tr>
</tbody>
</table></div>
<p><code>read_*</code> always returns a <code>tibble</code>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">temp_humid</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame"</code></pre>
</div>
<div id="date-and-time-made-easy" class="section level3" number="5.2.2">
<h3>
<span class="header-section-number">5.2.2</span> Date and time made easy<a class="anchor" aria-label="anchor" href="#date-and-time-made-easy"><i class="fas fa-link"></i></a>
</h3>
<p>A very useful package to handle date and time is called <code>lubridate</code>. It is not part of core packages in <code>tidyverse</code> but is installed with the long list of additional packages. We will use it to convert the variable <code>MESS_DATUM</code> to a real date-time variable.</p>
<p>The function <code><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_h()</a></code> converts character vectors to date-time objects provided they have the format <strong>y</strong>ear, <strong>m</strong>onth, <strong>d</strong>ay, <strong>h</strong>our. There are other function for different other formats; consult help.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>

<span class="va">temp_humid</span><span class="op">$</span><span class="va">MESS_DATUM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_h</a></span><span class="op">(</span><span class="va">temp_humid</span><span class="op">$</span><span class="va">MESS_DATUM</span><span class="op">)</span>

<span class="va">temp_humid</span></code></pre></div>
<pre><code>## # A tibble: 39,600 × 6
##    STATIONS_ID MESS_DATUM           QN_9 TT_TU RF_TU eor  
##          &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1        2261 2018-11-19 00:00:00     3  -2.8    99 eor  
##  2        2261 2018-11-19 01:00:00     3  -2.5   100 eor  
##  3        2261 2018-11-19 02:00:00     3  -2.3   100 eor  
##  4        2261 2018-11-19 03:00:00     3  -2     100 eor  
##  5        2261 2018-11-19 04:00:00     3  -1.9    99 eor  
##  6        2261 2018-11-19 05:00:00     3  -2.1    99 eor  
##  7        2261 2018-11-19 06:00:00     3  -1.8    99 eor  
##  8        2261 2018-11-19 07:00:00     3  -1.5    99 eor  
##  9        2261 2018-11-19 08:00:00     3  -1.1    99 eor  
## 10        2261 2018-11-19 09:00:00     3  -0.6    97 eor  
## # … with 39,590 more rows</code></pre>
<p>After conversion, the variables is recognised as <code>&lt;dttm&gt;</code> for date-time.</p>
</div>
<div id="summarize" class="section level3" number="5.2.3">
<h3>
<span class="header-section-number">5.2.3</span> Summarize<a class="anchor" aria-label="anchor" href="#summarize"><i class="fas fa-link"></i></a>
</h3>
<p>The three meteo station have the following IDs:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">station_ids</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'2261'</span> <span class="op">=</span> <span class="st">'Hof'</span>, <span class="st">'1420'</span> <span class="op">=</span> <span class="st">'Frankfurt'</span>, <span class="st">'2667'</span> <span class="op">=</span> <span class="st">'Koeln'</span><span class="op">)</span></code></pre></div>
<p>We want to know how many measurements per station the data set contains.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">STATIONS_ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
## # Groups:   STATIONS_ID [3]
##   STATIONS_ID     n
##         &lt;dbl&gt; &lt;int&gt;
## 1        1420 13200
## 2        2261 13200
## 3        2667 13200</code></pre>
<p>The operator <code>%&gt;%</code> is called <strong>pipe</strong> and is pronounced as <strong>and then</strong>. The code <code>temp_humid %&gt;% group_by(STATIONS_ID) %&gt;% count()</code> can be read as: take the object <code>temp_humid</code>, group it by <code>STATIONS_ID</code> and count the measurments in each group. The pipe operator comes from the package <code>magrittr</code> (<a href="https://magrittr.tidyverse.org/" class="uri">https://magrittr.tidyverse.org/</a>). It is a core operator in <code>tidyverse</code> and makes the code more readable and easier to follow for humans. Perhaps not in the beginning, but very soon 🤓.</p>
</div>
<div id="the-grammar-of-data-manipulation-dplyr" class="section level3" number="5.2.4">
<h3>
<span class="header-section-number">5.2.4</span> The grammar of data manipulation – <code>dplyr</code><a class="anchor" aria-label="anchor" href="#the-grammar-of-data-manipulation-dplyr"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/count.html">count()</a></code> is part of the library <code>dplyr</code>, a collection of functions all named after verbs. Thus, it is easy to imagine what the function does 😄). The 5 core functions are:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Function</th>
<th align="left">Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code></td>
<td align="left">filter data according to their values</td>
</tr>
<tr class="even">
<td align="left"><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code></td>
<td align="left">arrange rows</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code></td>
<td align="left">select variables according to their names</td>
</tr>
<tr class="even">
<td align="left"><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code></td>
<td align="left">create new variables, possibly using other variables</td>
</tr>
<tr class="odd">
<td align="left"><code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code></td>
<td align="left">summarize data with different functions</td>
</tr>
</tbody>
</table></div>
<p>If we want to know how many measurements were recorded for a particular meteo station, we first filter for its ID:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">STATIONS_ID</span> <span class="op">==</span> <span class="st">'2667'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##       n
##   &lt;int&gt;
## 1 13200</code></pre>
<p>The function <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> accepts logical tests. For every row in <code>STATION_ID</code>, <code>==</code> checks whether the entry equals 2667. <code>==</code> is a logical operator and means <em>is the left side equals the right sight</em>. If this is the case, then <code>==</code> returns <code>TRUE</code> otherwise it returns <code>FALSE</code>. <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> selects only those rows where <code>TRUE</code> was returned. Other useful logical operators are:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Operator</th>
<th align="left">Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>&gt;</code></td>
<td align="left">is the left side larger than the right side?</td>
</tr>
<tr class="even">
<td align="left"><code>&gt;=</code></td>
<td align="left">is the left side larger or equal the right side?</td>
</tr>
<tr class="odd">
<td align="left"><code>!=</code></td>
<td align="left">are left and right sides unequal?</td>
</tr>
</tbody>
</table></div>
<p>More logical and boolean operators are handeled in the tutorials (see below) and on help pages of <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>.</p>
<p>We can combine several test with the operator <strong>or</strong> <code>|</code>, for example. Here, we want to filter all rows containing either ID 2667 or ID 2261:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">STATIONS_ID</span> <span class="op">==</span> <span class="st">'2667'</span> <span class="op">|</span> <span class="va">STATIONS_ID</span> <span class="op">==</span> <span class="st">'2261'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">STATIONS_ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
## # Groups:   STATIONS_ID [2]
##   STATIONS_ID     n
##         &lt;dbl&gt; &lt;int&gt;
## 1        2261 13200
## 2        2667 13200</code></pre>
<p>The same can be achieved by excluding the third station:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">STATIONS_ID</span> <span class="op">!=</span> <span class="st">'1420'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">STATIONS_ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
## # Groups:   STATIONS_ID [2]
##   STATIONS_ID     n
##         &lt;dbl&gt; &lt;int&gt;
## 1        2261 13200
## 2        2667 13200</code></pre>
<p>As an alternative, we can use the operator <code>%in%</code> which checks whether the row contains one of the entries in a vector.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">STATIONS_ID</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'2667'</span>, <span class="st">'2261'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">STATIONS_ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
## # Groups:   STATIONS_ID [2]
##   STATIONS_ID     n
##         &lt;dbl&gt; &lt;int&gt;
## 1        2261 13200
## 2        2667 13200</code></pre>
</div>
<div id="visualise" class="section level3" number="5.2.5">
<h3>
<span class="header-section-number">5.2.5</span> Visualise<a class="anchor" aria-label="anchor" href="#visualise"><i class="fas fa-link"></i></a>
</h3>
<p>We plot the time series and use a trick to split them along three different plots with the function <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code>. It needs a variable to separate the data into plots and we chose <code>STATIONS_ID</code>. The splitting variable must be preceeded by <code>~</code>.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">temp_humid</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">MESS_DATUM</span>, y <span class="op">=</span> <span class="va">TT_TU</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">STATIONS_ID</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Time'</span>, y <span class="op">=</span> <span class="st">'Temperature (°C)'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-72-1.png" width="90%"></div>
</div>
<div id="new-variables-with-mutate" class="section level3" number="5.2.6">
<h3>
<span class="header-section-number">5.2.6</span> New variables with <code>mutate()</code><a class="anchor" aria-label="anchor" href="#new-variables-with-mutate"><i class="fas fa-link"></i></a>
</h3>
<p>We want to calculate the monthly means and standard deviations of the air temperature and humidity. First, we need to generate the temporal information, namely year and month that will be used to group the temperature values to calculate <code><a href="https://rdrr.io/r/base/mean.html">mean()</a></code> and <code><a href="https://rdrr.io/r/stats/sd.html">sd()</a></code>. This can be achieved with the functions <code><a href="https://lubridate.tidyverse.org/reference/year.html">year()</a></code>and <code><a href="https://lubridate.tidyverse.org/reference/month.html">month()</a></code> from library <code>lubridate</code>. The function <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> can create new variables in a data object.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op">&lt;-</span> <span class="va">temp_humid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">MESS_DATUM</span><span class="op">)</span>,
         month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">MESS_DATUM</span><span class="op">)</span><span class="op">)</span>

<span class="va">temp_humid</span></code></pre></div>
<pre><code>## # A tibble: 39,600 × 8
##    STATIONS_ID MESS_DATUM           QN_9 TT_TU RF_TU eor    year month
##          &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1        2261 2018-11-19 00:00:00     3  -2.8    99 eor    2018    11
##  2        2261 2018-11-19 01:00:00     3  -2.5   100 eor    2018    11
##  3        2261 2018-11-19 02:00:00     3  -2.3   100 eor    2018    11
##  4        2261 2018-11-19 03:00:00     3  -2     100 eor    2018    11
##  5        2261 2018-11-19 04:00:00     3  -1.9    99 eor    2018    11
##  6        2261 2018-11-19 05:00:00     3  -2.1    99 eor    2018    11
##  7        2261 2018-11-19 06:00:00     3  -1.8    99 eor    2018    11
##  8        2261 2018-11-19 07:00:00     3  -1.5    99 eor    2018    11
##  9        2261 2018-11-19 08:00:00     3  -1.1    99 eor    2018    11
## 10        2261 2018-11-19 09:00:00     3  -0.6    97 eor    2018    11
## # … with 39,590 more rows</code></pre>
<p>In the next step, we create a new data set and calculate the means and standard deviations. In order to get them <em>by station, year and month</em>, we group the data accordingly. To group by several variables, just enumerate them with a comma (no quotation or <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> necessary).</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_means</span> <span class="op">&lt;-</span> <span class="va">temp_humid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">STATIONS_ID</span>, <span class="va">year</span>, <span class="va">month</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_T <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">TT_TU</span><span class="op">)</span>, mean_RH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">RF_TU</span><span class="op">)</span>,
            sd_T <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">TT_TU</span><span class="op">)</span>, sd_RH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">RF_TU</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by 'STATIONS_ID', 'year'. You can override
## using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_means</span></code></pre></div>
<pre><code>## # A tibble: 57 × 7
## # Groups:   STATIONS_ID, year [9]
##    STATIONS_ID  year month mean_T mean_RH  sd_T sd_RH
##          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1        1420  2018    11   4.00    79.7  1.82  9.96
##  2        1420  2018    12   4.73    83.7  4.20 11.7 
##  3        1420  2019     1   2.12    79.3  3.76 10.0 
##  4        1420  2019     2   4.48    74.1  4.69 17.7 
##  5        1420  2019     3   8.28    68.5  4.08 16.1 
##  6        1420  2019     4  11.7     61.0  5.52 21.8 
##  7        1420  2019     5  12.7     67.5  4.64 20.1 
##  8        1420  2019     6  21.4     60.6  6.05 21.2 
##  9        1420  2019     7  21.6     55.6  5.90 21.8 
## 10        1420  2019     8  20.7     65.6  4.94 20.8 
## # … with 47 more rows</code></pre>
<p>The new object <code>monthly_means</code> is a grouped <code>tibble</code>, indicated by <em>grouped_df</em> in the output of <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> that shows the structure of an object.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">monthly_means</span><span class="op">)</span></code></pre></div>
<pre><code>## grouped_df [57 × 7] (S3: grouped_df/tbl_df/tbl/data.frame)
##  $ STATIONS_ID: num [1:57] 1420 1420 1420 1420 1420 1420 1420 1420 1420 1420 ...
##  $ year       : num [1:57] 2018 2018 2019 2019 2019 ...
##  $ month      : num [1:57] 11 12 1 2 3 4 5 6 7 8 ...
##  $ mean_T     : num [1:57] 4 4.73 2.12 4.48 8.28 ...
##  $ mean_RH    : num [1:57] 79.7 83.7 79.3 74.1 68.5 ...
##  $ sd_T       : num [1:57] 1.82 4.2 3.76 4.69 4.08 ...
##  $ sd_RH      : num [1:57] 9.96 11.68 10.04 17.73 16.1 ...
##  - attr(*, "groups")= tibble [9 × 3] (S3: tbl_df/tbl/data.frame)
##   ..$ STATIONS_ID: num [1:9] 1420 1420 1420 2261 2261 ...
##   ..$ year       : num [1:9] 2018 2019 2020 2018 2019 ...
##   ..$ .rows      : list&lt;int&gt; [1:9] 
##   .. ..$ : int [1:2] 1 2
##   .. ..$ : int [1:12] 3 4 5 6 7 8 9 10 11 12 ...
##   .. ..$ : int [1:5] 15 16 17 18 19
##   .. ..$ : int [1:2] 20 21
##   .. ..$ : int [1:12] 22 23 24 25 26 27 28 29 30 31 ...
##   .. ..$ : int [1:5] 34 35 36 37 38
##   .. ..$ : int [1:2] 39 40
##   .. ..$ : int [1:12] 41 42 43 44 45 46 47 48 49 50 ...
##   .. ..$ : int [1:5] 53 54 55 56 57
##   .. ..@ ptype: int(0) 
##   ..- attr(*, ".drop")= logi TRUE</code></pre>
<p>Some calculations are better done on ungrouped data. Therefore, we remove the grouping. This does not change the data itself.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="va">monthly_means</span><span class="op">)</span></code></pre></div>
<p>To plot the monthly data, we need a proper monthly date object. We will attribute the monthly means to the first of the respective month. Again, <code>lubridate</code> helps with this task. The function <code>parse_dat_time()</code> is a genral function taking a character string and returning a date-time object. We need to “glue” the variables <code>year</code> and <code>month</code> together with <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code> (yes, it is a zero, not an O!) to form such a string and specify that <code>orders = 'ym'</code>, i.e. year before month. Finally, we <code><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate()</a></code> the new variable <code>year_month</code> before the variable <code>year</code> for convenience (if not, it will be created as the last varialbe in the data set).</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_means</span> <span class="op">&lt;-</span> <span class="va">monthly_means</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year_month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">month</span><span class="op">)</span>, orders <span class="op">=</span> <span class="st">'ym'</span>, tz <span class="op">=</span> <span class="st">'CET'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html">relocate</a></span><span class="op">(</span><span class="va">year_month</span>, .before <span class="op">=</span> <span class="va">year</span><span class="op">)</span>

<span class="va">monthly_means</span></code></pre></div>
<pre><code>## # A tibble: 57 × 8
##    STATIONS_ID year_month           year month mean_T mean_RH  sd_T sd_RH
##          &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1        1420 2018-11-01 00:00:00  2018    11   4.00    79.7  1.82  9.96
##  2        1420 2018-12-01 00:00:00  2018    12   4.73    83.7  4.20 11.7 
##  3        1420 2019-01-01 00:00:00  2019     1   2.12    79.3  3.76 10.0 
##  4        1420 2019-02-01 00:00:00  2019     2   4.48    74.1  4.69 17.7 
##  5        1420 2019-03-01 00:00:00  2019     3   8.28    68.5  4.08 16.1 
##  6        1420 2019-04-01 00:00:00  2019     4  11.7     61.0  5.52 21.8 
##  7        1420 2019-05-01 00:00:00  2019     5  12.7     67.5  4.64 20.1 
##  8        1420 2019-06-01 00:00:00  2019     6  21.4     60.6  6.05 21.2 
##  9        1420 2019-07-01 00:00:00  2019     7  21.6     55.6  5.90 21.8 
## 10        1420 2019-08-01 00:00:00  2019     8  20.7     65.6  4.94 20.8 
## # … with 47 more rows</code></pre>
<p>Now, we can plot the mean air temperature.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">monthly_means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year_month</span>, y <span class="op">=</span> <span class="va">mean_T</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">STATIONS_ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Time'</span>, y <span class="op">=</span> <span class="st">'Temperature (°C)'</span>, color <span class="op">=</span> <span class="st">'Meteo station'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-78-1.png" width="90%"></div>
<p>We can also visualise the standard deviations.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">monthly_means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year_month</span>, y <span class="op">=</span> <span class="va">mean_T</span>, ymin <span class="op">=</span> <span class="va">mean_T</span> <span class="op">-</span> <span class="va">sd_T</span>, ymax <span class="op">=</span> <span class="va">mean_T</span> <span class="op">+</span> <span class="va">sd_T</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">STATIONS_ID</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Time'</span>, y <span class="op">=</span> <span class="st">'Temperature (°C)'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-79-1.png" width="90%"></div>
<p>Or use a semi-transparent band to show the variability (standard deviation).</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">monthly_means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year_month</span>, y <span class="op">=</span> <span class="va">mean_T</span>, ymin <span class="op">=</span> <span class="va">mean_T</span> <span class="op">-</span> <span class="va">sd_T</span>, ymax <span class="op">=</span> <span class="va">mean_T</span> <span class="op">+</span> <span class="va">sd_T</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">STATIONS_ID</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Time'</span>, y <span class="op">=</span> <span class="st">'Temperature (°C)'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-80-1.png" width="90%"></div>
<p>One last detail. The titles on top of the facets show the station IDs. When you are not an employee of German Meteo Service, you probably do not know them by hart. It is better to use the city names. The vector <code>station_ids</code> is a so called named vector and has the right structure to change the titles in the facets: it assignes to every id its city name, i.e. 2261 = ‘Hof.’</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">station_ids</span></code></pre></div>
<pre><code>##        2261        1420        2667 
##       "Hof" "Frankfurt"     "Koeln"</code></pre>
<p>We use <code>station_ids</code> to change the titles:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">monthly_means</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year_month</span>, y <span class="op">=</span> <span class="va">mean_T</span>, ymin <span class="op">=</span> <span class="va">mean_T</span> <span class="op">-</span> <span class="va">sd_T</span>, ymax <span class="op">=</span> <span class="va">mean_T</span> <span class="op">+</span> <span class="va">sd_T</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">STATIONS_ID</span>, nrow <span class="op">=</span> <span class="fl">3</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>STATIONS_ID <span class="op">=</span> <span class="va">station_ids</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Time'</span>, y <span class="op">=</span> <span class="st">'Temperature (°C)'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="environmental_stat_files/figure-html/unnamed-chunk-82-1.png" width="90%"></div>
</div>
</div>
<div id="practice-on-your-own-4" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Practice on your own!<a class="anchor" aria-label="anchor" href="#practice-on-your-own-4"><i class="fas fa-link"></i></a>
</h2>
<ol class="exercises"><ol style="list-style-type: decimal">
<li><p>Plot the means and standard deviations of the air humidity instead of air temperature.</p></li>
<li><p>Do the tutorials “Work with data” from the Primers collection by RStudio Cloud. You can access the tutorials here: <a href="https://rstudio.cloud/learn/primers/2" class="uri">https://rstudio.cloud/learn/primers/2</a></p></li>
<li><p>Do the tutorials “Visualize Data” from the Primers collection by RStudio Cloud. You can access the tutorials here:<a href="https://rstudio.cloud/learn/primers/3" class="uri">https://rstudio.cloud/learn/primers/3</a></p></li>
</ol></ol>
</div>
<div id="reading-assignment-3" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Reading assignment<a class="anchor" aria-label="anchor" href="#reading-assignment-3"><i class="fas fa-link"></i></a>
</h2>
<p>Read chapter 3 (to 3.5) in <span class="citation"><a href="literature-1.html#ref-ModernDive" role="doc-biblioref">Ismay and Kim</a> (<a href="literature-1.html#ref-ModernDive" role="doc-biblioref">2021</a>)</span></p>
<!-- ## Turning in your work -->
<!-- - Save your R Notebook and download the .Rmd file to your computer. You don't need to download the .nb.html file. -->
<!-- - Upload your R Notebook to ILIAS. You will find an upload option in today's session. -->
<!-- - You should receive a solution file after the submission. -->
<!-- ```{block, type='rmdalert'} -->
<!-- Be sure to upload before the deadline! -->
<!-- ``` -->
</div>
<div id="additional-reading-and-videos" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Additional reading and videos<a class="anchor" aria-label="anchor" href="#additional-reading-and-videos"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>More information on statistical graphical summaries and geoms: R4DS <span class="citation"><a href="literature-1.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund</a> (<a href="literature-1.html#ref-r4ds" role="doc-biblioref">2021</a>)</span>: Chapter 5 “Data transformation”</p></li>
<li><p>A <a href="https://www.youtube.com/watch?v=go5Au01Jrvs">live exploratory data analysis</a> by the main author of <code>tidyverse</code>, Hadley Wickham. Really informative, but Dr. Wickham types too fast 😄.</p></li>
</ul>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="import-visualize-and-explore-data.html"><span class="header-section-number">4</span> Import, visualize and explore data</a></div>
<div class="next"><a href="sampling.html"><span class="header-section-number">6</span> Sampling and variability</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidyverse"><span class="header-section-number">5</span> Explorative workflow with tidyverse</a></li>
<li><a class="nav-link" href="#core-packages"><span class="header-section-number">5.1</span> Core packages</a></li>
<li>
<a class="nav-link" href="#exploratory-data-analysis"><span class="header-section-number">5.2</span> Exploratory data analysis</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#read-data-revisited"><span class="header-section-number">5.2.1</span> Read data, revisited</a></li>
<li><a class="nav-link" href="#date-and-time-made-easy"><span class="header-section-number">5.2.2</span> Date and time made easy</a></li>
<li><a class="nav-link" href="#summarize"><span class="header-section-number">5.2.3</span> Summarize</a></li>
<li><a class="nav-link" href="#the-grammar-of-data-manipulation-dplyr"><span class="header-section-number">5.2.4</span> The grammar of data manipulation – dplyr</a></li>
<li><a class="nav-link" href="#visualise"><span class="header-section-number">5.2.5</span> Visualise</a></li>
<li><a class="nav-link" href="#new-variables-with-mutate"><span class="header-section-number">5.2.6</span> New variables with mutate()</a></li>
</ul>
</li>
<li><a class="nav-link" href="#practice-on-your-own-4"><span class="header-section-number">5.3</span> Practice on your own!</a></li>
<li><a class="nav-link" href="#reading-assignment-3"><span class="header-section-number">5.4</span> Reading assignment</a></li>
<li><a class="nav-link" href="#additional-reading-and-videos"><span class="header-section-number">5.5</span> Additional reading and videos</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ChrisBogner/environmental_stat/blob/master/docs/05-tidyverse.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ChrisBogner/environmental_stat/edit/master/docs/05-tidyverse.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Environmental Statistics</strong>: Summer term 2021" was written by Christina Bogner. It was last built on 2022-03-07.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
