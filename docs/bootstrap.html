<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>7 Bootstrap and confidence intervals | Environmental Statistics</title>

    <meta name="author" content="Christina Bogner" />
  
   <meta name="description" content="Lecture notes for the course Environmental Statistics in IMES (UoC), based on the material by ModernDive" />
   <meta name="generator" content="placeholder" />
  <meta property="og:title" content="7 Bootstrap and confidence intervals | Environmental Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lecture notes for the course Environmental Statistics in IMES (UoC), based on the material by ModernDive" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Bootstrap and confidence intervals | Environmental Statistics" />
  
  <meta name="twitter:description" content="Lecture notes for the course Environmental Statistics in IMES (UoC), based on the material by ModernDive" />
  
  <!-- JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet" />
    <script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script>
    <script src="libs/bs3compat-0.3.1/transition.js"></script>
    <script src="libs/bs3compat-0.3.1/tabs.js"></script>
    <script src="libs/bs3compat-0.3.1/bs3compat.js"></script>
    <link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet" />
    <script src="libs/bs4_book-1.0.0/bs4_book.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script>

  <!-- CSS -->
  <style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
    <style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
      <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="font-awesome.min.css" />
  
</head>

<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book">
    <a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Summer term 2022">Environmental Statistics</a>:
        <small class="text-muted">Summer term 2022</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
      </form>

      <nav aria-label="Table of contents">
        <h2>Table of contents</h2>
        <div id="book-toc"></div>

        <div class="book-extra">
          <p><a id="book-repo" href="#">View book source <i class="fab fa-github"></i></a></li></p>
        </div>
      </nav>
    </div>
  </header>

  <main class="col-sm-12 col-md-9 col-lg-7" id="content">
<div id="bootstrap" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Bootstrap and confidence intervals</h1>
<div class="rmdoutcomes">
<ul>
<li>
Explain the idea behind the bootstrap
</li>
<li>
Calculate bootstrap confidence intervals for the mean
</li>
</ul>
</div>
<p>In chapter <a href="sampling.html#sampling">6</a> we studied the variability of <strong>repeated random sampling from a population</strong>. We did computer experiments and sampled from a simulated population repeatedly without replacement (i.e.¬†the data could appear in the sample only once) and calculated a statistics, the proportion of rural and urban residents. Such a statistics is a <strong>random variable</strong>, and it is characterized by the <strong>sampling distribution</strong>. It shows which values you can expect by randomly sampling from a population.</p>
<p>We learned that the shape of the sampling distribution and the size of its standard error depended on the sample size. In this chapter, we will learn how to quantify the standard error or to calculate plausible values (confidence intervals) for real-life applications, when you have one sample only.</p>
<div id="the-formulas" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> The formulas</h2>
<p>You will never have the opportunity to sample/survey repeatedly to estimate the information (i.e.¬†a statistics or parameter) about the population of interest. In real-life applications, you will have one (hopefully cleverly obtained) random sample. So, how can we have access to the shape of the sampling distribution? For several standard statistics, there are formulas that describe the standard error. You have probably learned that the standard error for the estimated mean equalled <span class="math inline">\(\sigma/\sqrt(n)\)</span>, <span class="math inline">\(\sigma\)</span> being the variance of the population and <span class="math inline">\(n\)</span> the sample size. If you don‚Äôt know the variance of the population, then you have to estimate it from the sample itself. But where does this formula come from? The crucial <strong>Central Limit Theorem</strong> tells us that the random variable <strong>mean</strong> that we can estimate from our random sample is normally distributed with a mean equalled to the true mean of the population and the standard deviation of, you guessed it, <span class="math inline">\(\sigma/\sqrt(n)\)</span>. Based on the normal distribution, we can calculate plausible values, a so-called <strong>confidence interval</strong>. Informally, we could define the confidence interval as follows:</p>
<blockquote>
<p>Is there a plausible range of values that we could obtain if we randomly sample from a population? Plausible means that if we repeated the sampling very often, this range would contain the true mean in let‚Äôs say 95% of the time. Such a plausible range is called a <strong>95% confidence interval</strong>.</p>
</blockquote>
<p>Because we know the theoretical distribution of the mean we can calculate the 95% confidence interval as <span class="math inline">\(\hat\mu \pm 1.96 \cdot SE\)</span>, with <span class="math inline">\(\hat\mu\)</span> being the estimated mean, <span class="math inline">\(SE\)</span> the standard error <span class="math inline">\(\sigma/\sqrt(n)\)</span> and the magic factor of 1.96 comes from the fact that in a normal distribution, 95% of all values fall into the interval <span class="math inline">\(\mu \pm 1.96 \cdot sd\)</span>, <span class="math inline">\(sd\)</span> being the standard deviation.</p>
</div>
<div id="bootstrap-use-your-computer" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Bootstrap ‚Äì use your computer</h2>
<p>Formulas date from the early time of statistics, where computational power was limited or unavailable and approximations were the only tools one could use to estimate the variability. The Central Limit Theorem is very useful, but theoretical distributions do not always exist. In such cases, we can use our computer to calculate confidence intervals using <strong>re-sampling</strong>, i.e.¬†repeated sampling from our random sample. This method is called bootstrap (or bootstrapping) and sounds like self-deception √† la Baron Munchausen at first glance (Figure <a href="bootstrap.html#fig:meunch">7.1</a>). However, it has a solid mathematical foundation <span class="citation">(<a href="literature-1.html#ref-Efron1979" role="doc-biblioref">Efron 1979</a>)</span>.</p>
<div class="figure"><span style="display:block;" id="fig:meunch"></span>
<img src="figures/M%C3%BCnchhausen-Sumpf-Hosemann.png" alt="M√ºnchhausen removes himself from the swamp using his own braids (Theodor Hosemann (1807-1875), Public domain, via Wikimedia Commons) [Link to figure](https://upload.wikimedia.org/wikipedia/commons/a/ad/M%C3%BCnchhausen-Sumpf-Hosemann.png)" width="80%" />
<p class="caption">
Figure 7.1: M√ºnchhausen removes himself from the swamp using his own braids (Theodor Hosemann (1807-1875), Public domain, via Wikimedia Commons) <a href="https://upload.wikimedia.org/wikipedia/commons/a/ad/M%C3%BCnchhausen-Sumpf-Hosemann.png">Link to figure</a>
</p>
</div>
<p>Figure <a href="bootstrap.html#fig:sampling-world">7.2</a> shows the setup that we practised in chapter <a href="sampling.html#sampling">6</a>. We wanted to estimate a parameter (proportion of rural and urban residents) called <span class="math inline">\(\mu\)</span> in the figure, and we sampled randomly several times from the population. From all those random samples, we calculated our statistics and obtained the sampling distribution.</p>
<div class="figure"><span style="display:block;" id="fig:sampling-world"></span>
<img src="figures/sampling_world.png" alt="Calculation of a sampling distribution by repeated random sampling from a population. Figure by @Hesterberg2015, their Figure 4. The publication is open-access and can be used for non-commercial purposes. [Link to licence](https://www.tandfonline.com/action/showCopyRight?scroll=top&amp;doi=10.1080%2F00031305.2015.1089789)" width="80%" />
<p class="caption">
Figure 7.2: Calculation of a sampling distribution by repeated random sampling from a population. Figure by <span class="citation">Hesterberg (<a href="literature-1.html#ref-Hesterberg2015" role="doc-biblioref">2015</a>)</span>, their Figure 4. The publication is open-access and can be used for non-commercial purposes. <a href="https://www.tandfonline.com/action/showCopyRight?scroll=top&amp;doi=10.1080%2F00031305.2015.1089789">Link to licence</a>
</p>
</div>
<p>Figure <a href="bootstrap.html#fig:sampling-bootstrap">7.3</a> looks nearly the same, except one important difference. We don‚Äôt have access to several random samples from the population, but have one random sample only. And now we remember that we invested time and energy in thinking about the best way to obtain this sample, and we believe that it is representative of our population. Thus, we can think about this sample as our <em>mini</em> population. We replace the population by its miniature, i.e.¬†our sample, and sample from this sample as if it were the true population. However, because the sample is limited in size, we have to sample <strong>with replacement</strong>. The random samples we obtain by sampling with replacement from the original random sample are called bootstrap samples. For each of those bootstrap samples, we calculate the statistics and obtain its bootstrap sampling distribution. The confidence intervals are most often calculated by the so-called percentile method: we take the 2.5% quantile and the 97.5% quantile from the sampling distribution. The range of values in-between equals the 95% bootstrap confidence interval.</p>
<div class="figure"><span style="display:block;" id="fig:sampling-bootstrap"></span>
<img src="figures/sampling_bootstrap.png" alt="Calculation of a sampling distribution by repeated random sampling with replacement from a sample. Figure by @Hesterberg2015, their Figure 5. The publication is open-access and can be used for non-commercial purposes. [Link to licence](https://www.tandfonline.com/action/showCopyRight?scroll=top&amp;doi=10.1080%2F00031305.2015.1089789)" width="80%" />
<p class="caption">
Figure 7.3: Calculation of a sampling distribution by repeated random sampling with replacement from a sample. Figure by <span class="citation">Hesterberg (<a href="literature-1.html#ref-Hesterberg2015" role="doc-biblioref">2015</a>)</span>, their Figure 5. The publication is open-access and can be used for non-commercial purposes. <a href="https://www.tandfonline.com/action/showCopyRight?scroll=top&amp;doi=10.1080%2F00031305.2015.1089789">Link to licence</a>
</p>
</div>
</div>
<div id="confidence-intervals-for-the-mean-travel-time" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Confidence intervals for the mean travel time</h2>
<p>Let‚Äôs come back to our simulated getsmarter university population and estimate the mean travel time with its bootstrap confidence interval.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="bootstrap.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb113-2"><a href="bootstrap.html#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(infer)</span></code></pre></div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="bootstrap.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb114-2"><a href="bootstrap.html#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="bootstrap.html#cb114-3" aria-hidden="true" tabindex="-1"></a>student_id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12000</span></span>
<span id="cb114-4"><a href="bootstrap.html#cb114-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb114-5"><a href="bootstrap.html#cb114-5" aria-hidden="true" tabindex="-1"></a>travel_time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">12000</span> <span class="sc">*</span> <span class="fl">0.8</span>, <span class="at">min =</span> <span class="dv">5</span>, <span class="at">max =</span> <span class="dv">40</span>),</span>
<span id="cb114-6"><a href="bootstrap.html#cb114-6" aria-hidden="true" tabindex="-1"></a>             <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">12000</span> <span class="sc">*</span> <span class="fl">0.2</span>, <span class="at">min =</span> <span class="dv">60</span>, <span class="at">max =</span> <span class="dv">120</span>))</span>
<span id="cb114-7"><a href="bootstrap.html#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="bootstrap.html#cb114-8" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;m&#39;</span>, <span class="st">&#39;f&#39;</span>), <span class="at">size =</span> <span class="dv">12000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb114-9"><a href="bootstrap.html#cb114-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-10"><a href="bootstrap.html#cb114-10" aria-hidden="true" tabindex="-1"></a>residence <span class="ot">&lt;-</span> <span class="fu">sapply</span>(travel_time, <span class="cf">function</span>(x) {</span>
<span id="cb114-11"><a href="bootstrap.html#cb114-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">&lt;</span> <span class="dv">30</span>) <span class="st">&#39;urban&#39;</span></span>
<span id="cb114-12"><a href="bootstrap.html#cb114-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="st">&#39;rural&#39;</span></span>
<span id="cb114-13"><a href="bootstrap.html#cb114-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb114-14"><a href="bootstrap.html#cb114-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-15"><a href="bootstrap.html#cb114-15" aria-hidden="true" tabindex="-1"></a>transport <span class="ot">&lt;-</span> <span class="fu">sapply</span>(travel_time, <span class="cf">function</span>(x) {</span>
<span id="cb114-16"><a href="bootstrap.html#cb114-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="st">&#39;foot&#39;</span></span>
<span id="cb114-17"><a href="bootstrap.html#cb114-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span>(x <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">15</span>) <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;foot&#39;</span>, <span class="st">&#39;bike&#39;</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb114-18"><a href="bootstrap.html#cb114-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span>(x <span class="sc">&gt;</span> <span class="dv">15</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">45</span>) <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;bus&#39;</span>, <span class="st">&#39;bike&#39;</span>, <span class="st">&#39;car&#39;</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb114-19"><a href="bootstrap.html#cb114-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&#39;bus&#39;</span>, <span class="st">&#39;car&#39;</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb114-20"><a href="bootstrap.html#cb114-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb114-21"><a href="bootstrap.html#cb114-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-22"><a href="bootstrap.html#cb114-22" aria-hidden="true" tabindex="-1"></a>time_lib <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">-</span> <span class="fl">0.7</span> <span class="sc">*</span> travel_time <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(travel_time), <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb114-23"><a href="bootstrap.html#cb114-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-24"><a href="bootstrap.html#cb114-24" aria-hidden="true" tabindex="-1"></a>getsmarter_pop <span class="ot">&lt;-</span> <span class="fu">tibble</span>(student_id, gender, residence, transport, travel_time, time_lib)</span>
<span id="cb114-25"><a href="bootstrap.html#cb114-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-26"><a href="bootstrap.html#cb114-26" aria-hidden="true" tabindex="-1"></a>getsmarter_pop</span></code></pre></div>
<pre><code>## # A tibble: 12,000 √ó 6
##    student_id gender residence transport travel_time time_lib
##         &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;
##  1          1 f      urban     bus             15.1      294.
##  2          2 f      rural     bike            32.6      254.
##  3          3 f      urban     bike            19.3      231.
##  4          4 m      rural     car             35.9      245.
##  5          5 m      rural     bus             37.9      234.
##  6          6 f      urban     foot             6.59     303.
##  7          7 f      urban     bus             23.5      284.
##  8          8 m      rural     car             36.2      274.
##  9          9 m      urban     bike            24.3      299.
## 10         10 f      urban     bus             21.0      282.
## # ‚Ä¶ with 11,990 more rows</code></pre>
<p>We survey 200 students.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="bootstrap.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">345</span>)</span>
<span id="cb116-2"><a href="bootstrap.html#cb116-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3"><a href="bootstrap.html#cb116-3" aria-hidden="true" tabindex="-1"></a>survey_size <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb116-4"><a href="bootstrap.html#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="bootstrap.html#cb116-5" aria-hidden="true" tabindex="-1"></a>survey <span class="ot">&lt;-</span> <span class="fu">rep_sample_n</span>(getsmarter_pop, <span class="at">size =</span> survey_size, <span class="at">replace =</span> <span class="cn">FALSE</span>, <span class="at">reps =</span> <span class="dv">1</span>)</span></code></pre></div>
<p>The true mean travel time to the university and the mean from the survey equal</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="bootstrap.html#cb117-1" aria-hidden="true" tabindex="-1"></a>mean_pop <span class="ot">&lt;-</span> getsmarter_pop <span class="sc">%&gt;%</span> </span>
<span id="cb117-2"><a href="bootstrap.html#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(travel_time))</span>
<span id="cb117-3"><a href="bootstrap.html#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="bootstrap.html#cb117-4" aria-hidden="true" tabindex="-1"></a>mean_pop</span></code></pre></div>
<pre><code>## # A tibble: 1 √ó 1
##    mean
##   &lt;dbl&gt;
## 1  36.0</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="bootstrap.html#cb119-1" aria-hidden="true" tabindex="-1"></a>mean_survey <span class="ot">&lt;-</span> survey <span class="sc">%&gt;%</span> </span>
<span id="cb119-2"><a href="bootstrap.html#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(travel_time))</span>
<span id="cb119-3"><a href="bootstrap.html#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="bootstrap.html#cb119-4" aria-hidden="true" tabindex="-1"></a>mean_survey</span></code></pre></div>
<pre><code>## # A tibble: 1 √ó 2
##   replicate  mean
##       &lt;int&gt; &lt;dbl&gt;
## 1         1  34.1</code></pre>
<p>To calculate the bootstrap distribution, we sample from the data set <code>survey</code> with replacement. The size of the bootstrap samples always equal the size of the original sample. We use the same function <code>rep_sample_n</code> as in chapter <a href="sampling.html#sampling">6</a>, but change <code>replace = TRUE</code>.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="bootstrap.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">345</span>)</span>
<span id="cb121-2"><a href="bootstrap.html#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="bootstrap.html#cb121-3" aria-hidden="true" tabindex="-1"></a>reps_num <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb121-4"><a href="bootstrap.html#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="bootstrap.html#cb121-5" aria-hidden="true" tabindex="-1"></a>survey_reps_bootstrap <span class="ot">&lt;-</span> <span class="fu">rep_sample_n</span>(survey, <span class="at">size =</span> survey_size, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">reps =</span> reps_num)</span>
<span id="cb121-6"><a href="bootstrap.html#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="bootstrap.html#cb121-7" aria-hidden="true" tabindex="-1"></a>survey_reps_bootstrap</span></code></pre></div>
<pre><code>## # A tibble: 2,000,000 √ó 7
## # Groups:   replicate [10,000]
##    replicate student_id gender residence transport travel_time time_lib
##        &lt;int&gt;      &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;
##  1         1       7038 m      urban     bus             29.4      243.
##  2         1        493 m      urban     bus             21.1      303.
##  3         1       3442 m      rural     car             30.3      311.
##  4         1       4920 f      urban     bus             21.1      290.
##  5         1       3178 f      urban     foot             8.07     325.
##  6         1       7694 f      rural     car             31.3      295.
##  7         1       9479 m      rural     bus             39.5      302.
##  8         1       3367 m      rural     car             36.4      272.
##  9         1       5985 f      urban     bike            15.9      303.
## 10         1        843 m      urban     bike            26.4      300.
## # ‚Ä¶ with 1,999,990 more rows</code></pre>
<p>Because we sample with replacement, students can now appear several times in one and the same bootstrap sample. Let‚Äôs check this for the first 50 bootstrap samples. Student 4787 was sampled 8 times in the replicate 43, for example.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="bootstrap.html#cb123-1" aria-hidden="true" tabindex="-1"></a>survey_reps_bootstrap <span class="sc">%&gt;%</span> </span>
<span id="cb123-2"><a href="bootstrap.html#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(replicate <span class="sc">%in%</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb123-3"><a href="bootstrap.html#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(replicate, student_id) <span class="sc">%&gt;%</span> </span>
<span id="cb123-4"><a href="bootstrap.html#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tally</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb123-5"><a href="bootstrap.html#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">!=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb123-6"><a href="bootstrap.html#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 2,657 √ó 3
## # Groups:   replicate [50]
##    replicate student_id     n
##        &lt;int&gt;      &lt;int&gt; &lt;int&gt;
##  1        43       4787     8
##  2        20       5985     6
##  3        34       7749     6
##  4        38       5641     6
##  5        41       8456     6
##  6         3       7083     5
##  7         3      10943     5
##  8         5       8994     5
##  9         6      10118     5
## 10         8      11425     5
## # ‚Ä¶ with 2,647 more rows</code></pre>
<p>Now we can calculate the mean travel times from the bootstrap samples.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="bootstrap.html#cb125-1" aria-hidden="true" tabindex="-1"></a>res_means_bootstrap <span class="ot">&lt;-</span> survey_reps_bootstrap <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="bootstrap.html#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(replicate) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="bootstrap.html#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_tt =</span> <span class="fu">mean</span>(travel_time))</span>
<span id="cb125-4"><a href="bootstrap.html#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="bootstrap.html#cb125-5" aria-hidden="true" tabindex="-1"></a>res_means_bootstrap</span></code></pre></div>
<pre><code>## # A tibble: 10,000 √ó 2
##    replicate mean_tt
##        &lt;int&gt;   &lt;dbl&gt;
##  1         1    32.6
##  2         2    31.9
##  3         3    38.9
##  4         4    33.5
##  5         5    35.4
##  6         6    37.2
##  7         7    34.4
##  8         8    33.4
##  9         9    35.5
## 10        10    31.0
## # ‚Ä¶ with 9,990 more rows</code></pre>
<p>The standard error and the 95% confidence interval based on the bootstrap are calculated as follows:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="bootstrap.html#cb127-1" aria-hidden="true" tabindex="-1"></a>stat_bootstrap <span class="ot">&lt;-</span> res_means_bootstrap <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="bootstrap.html#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_bootstrap =</span> <span class="fu">mean</span>(mean_tt), <span class="at">se =</span> <span class="fu">sd</span>(mean_tt), <span class="at">ci_2.5 =</span> <span class="fu">quantile</span>(mean_tt, <span class="at">probs =</span> <span class="fl">0.025</span>), <span class="at">ci_97.5 =</span> <span class="fu">quantile</span>(mean_tt, <span class="at">probs =</span> <span class="fl">0.975</span>))</span>
<span id="cb127-3"><a href="bootstrap.html#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="bootstrap.html#cb127-4" aria-hidden="true" tabindex="-1"></a>stat_bootstrap</span></code></pre></div>
<pre><code>## # A tibble: 1 √ó 4
##   mean_bootstrap    se ci_2.5 ci_97.5
##            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
## 1           34.1  2.06   30.1    38.3</code></pre>
</div>
<div id="bootstrap-with-the-library-infer" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Bootstrap with the library <code>infer</code></h2>
<p>The library <code>infer</code> offers a convenient framework for calculating the bootstrap confidence intervals and to do hypothesis tests. We will talk about the latter in a later session. <code>infer</code> is a dedicated package for <em>tidy</em> inference and is organized around 5 verbs:</p>
<ol style="list-style-type: decimal">
<li><code>specify()</code> variables or relationships between them</li>
<li><code>hypothesize()</code> define the null hypothesis (for hypothesis tests only)</li>
<li><code>generate()</code> generate data either for the confidence intervals or under the null hypothesis</li>
<li><code>calculate()</code> the sampling distribution</li>
<li><code>visualize()</code> visualize the sampling distribution</li>
</ol>
<p>How does our example of calculating the bootstrap confidence intervals for the mean travel time look like in the <code>infer</code> workflow?</p>
<p>We first calculate the bootstrap distribution.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="bootstrap.html#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">345</span>)</span>
<span id="cb129-2"><a href="bootstrap.html#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="bootstrap.html#cb129-3" aria-hidden="true" tabindex="-1"></a>bootstrap_distribution <span class="ot">&lt;-</span> survey <span class="sc">%&gt;%</span></span>
<span id="cb129-4"><a href="bootstrap.html#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(<span class="at">response =</span> travel_time) <span class="sc">%&gt;%</span> </span>
<span id="cb129-5"><a href="bootstrap.html#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">10000</span>, <span class="at">type =</span> <span class="st">&#39;bootstrap&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-6"><a href="bootstrap.html#cb129-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">&#39;mean&#39;</span>)</span></code></pre></div>
<p>Then, we calculate the confidence intervals based on the percentile method.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="bootstrap.html#cb130-1" aria-hidden="true" tabindex="-1"></a>percentile_ci <span class="ot">&lt;-</span> bootstrap_distribution <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="bootstrap.html#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_confidence_interval</span>(<span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">type =</span> <span class="st">&quot;percentile&quot;</span>)</span>
<span id="cb130-3"><a href="bootstrap.html#cb130-3" aria-hidden="true" tabindex="-1"></a>percentile_ci</span></code></pre></div>
<pre><code>## # A tibble: 1 √ó 2
##   lower_ci upper_ci
##      &lt;dbl&gt;    &lt;dbl&gt;
## 1     30.1     38.3</code></pre>
<p>And then visualize all results. Because the function <code>visualize</code> is based on <code>ggplot2</code>, we can add custom axis labels.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="bootstrap.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(bootstrap_distribution) <span class="sc">+</span> </span>
<span id="cb132-2"><a href="bootstrap.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade_confidence_interval</span>(<span class="at">endpoints =</span> percentile_ci, <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;khaki&quot;</span>) <span class="sc">+</span></span>
<span id="cb132-3"><a href="bootstrap.html#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> mean_pop<span class="sc">$</span>mean, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="sc">+</span></span>
<span id="cb132-4"><a href="bootstrap.html#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;Mean trave time (min)&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Frequency&#39;</span>)</span></code></pre></div>
<p><img src="environmental_stat_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
</div>
<div id="interpreting-the-confidence-intervals" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Interpreting the confidence intervals</h2>
<p>The upper and lower limit of the confidence interval depend on the sample, i.e.¬†they are themselves random variables. Definitely, random variables are everywhere üòÑ. It means that the confidence interval could fail to include the true population parameter. We are now ready for a more formal definition of a confidence interval:</p>
<blockquote>
<p>If we repeat the sampling very often and recalculate the 95% confidence intervals, we expect them to contain the true population parameters in about 95% of the time.</p>
</blockquote>
<p>It means that some confidence intervals won‚Äôt contain the true population parameter.</p>
<p>The confidence interval is our best guess of plausible values for the population parameter. In case of a theoretical distribution of the statistics, the bootstrap and the theoretical confidence intervals coincide. Often, the interpretation is short-handed as: We are 95% confident that the confidence interval captures the true parameter. This is incorrect. It is better to state that in 95% of the time, the confidence interval captures the true population parameter. And now you know what is meant by ‚Äú95% of the time‚Äù üòÑ.</p>
</div>
<div id="practice-on-your-own-6" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Practice on your own!</h2>
<ol class="exercises">
<ol style="list-style-type: decimal">
<li><p>Repeat the analysis we did for the mean travel time now for the proportion of urban residents. Use the workflow in <code>infer</code>. Hint: <code>specify(response = residence, success = 'urban')</code>.</p></li>
<li><p>How does the width of the confidence interval depend on the sample size? Repeat the analysis for the mean travel time for a survey of 30 students.</p></li>
</ol>
</ol>
</div>
<div id="reading-assignment-5" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Reading assignment</h2>
<p>Chapter 8 in <span class="citation">Ismay and Kim (<a href="literature-1.html#ref-ModernDive" role="doc-biblioref">2021</a>)</span></p>
</div>
<div id="turning-in-your-work-5" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> Turning in your work</h2>
<ul>
<li>Save your R Notebook as an *.Rmd file.</li>
<li>Upload your R Notebook to ILIAS. You don‚Äôt need to upload the .nb.html file. You will find an upload option in today‚Äôs session.</li>
<li>You should receive a solution file after your upload. <strong>Be sure to upload before the deadline!</strong></li>
</ul>

</div>
</div>
  </main>

  <div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page">
      <h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          <li><a id="book-source" href="#">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="#">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
      </div>
    </nav>
  </div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5">
  <div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Environmental Statistics</strong>: Summer term 2022" was written by Christina Bogner. It was last built on 2022-06-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
<script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>

</html>
